<!-- date range selection screen -->
<div *ngIf="selectScreen; else elseBlock">
  <div id='route-records-wrapper'>
    <p>Choose a date range to get records from:</p>
    <mat-form-field appearance="fill">
      <mat-label>Start Date - End Date</mat-label>
      <mat-date-range-input [rangePicker]="picker">
        <input matStartDate [(ngModel)]="startDate" name="startDate" placeholder="Start date">
        <input matEndDate [(ngModel)]="endDate" name="endDate" placeholder="End date">
      </mat-date-range-input>
      <mat-datepicker-toggle matSuffix [for]="picker">
        <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
      </mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>
    </mat-form-field>
  
    <div>
      <button mat-raised-button class="select-screen-button" color="primary" (click)="handleViewRecords()"
        [disabled]="disableButton">View</button>
    </div>
    <div>
      <button mat-raised-button class="select-screen-button" color="primary" (click)="handleDownload()"
        [disabled]="disableButton">Download</button>
    </div>
  </div>
</div>
<!-- END date range selection screen -->

<!-- rows and content -->
<ng-template #elseBlock>
  <div id='table-top'>
    <button (click)="handleBack()" mat-icon-button aria-label="Go back to date selection" type="button">
      <mat-icon>keyboard_backspace</mat-icon>
    </button>
  </div>
  <app-expansion-table [defaultPageSize]="10" [pageSizeOptions]="[5, 10, 25, 50]" [data$]="records$"
    [displayData]="displayData">
    <ng-template let-record>
      <div class='row-buttons-wrapper'>
        <button mat-raised-button color="primary" aria-label="View or Edit This Record" (click)="handleStartEdit(record)" type="button">View/Edit This Record</button>
        <button mat-raised-button color="warn" aria-label="Delete This Record" (click)="handleStartDeletion(record)" type="button">Delete This Record</button>
      </div>
    </ng-template>
  </app-expansion-table>
</ng-template>
<!-- END rows and content -->

<!-- deletion confirmation modal -->
<app-projection-dialog [control$]="controlDeletionDialog$" (getDialogRef)="receiveDeletionDialogRef($event)">
  <h2 mat-dialog-title>Are you sure you want to delete this record?</h2>
  <mat-dialog-actions align="end">
    <button (click)="closeDeletionDialog()" mat-icon-button aria-label="Cancel deleting record" type="button">
      <mat-icon>close</mat-icon>
    </button>
    <button mat-icon-button aria-label="Confirm deleting record" type="submit" (click)="handleConfirmDeletion()">
      <mat-icon>check</mat-icon>
    </button>
  </mat-dialog-actions>
</app-projection-dialog>
<!-- END deletion confirmation modal -->

<!-- edit record modal -->
<app-projection-dialog [control$]="controlEditDialog$" (getDialogRef)="receiveEditDialogRef($event)">
  <div id='form-title'>
    <h2 mat-dialog-title>Edit Record</h2>
    <button (click)="closeEditDialog()" mat-icon-button aria-label="Close edit form" type="button">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <form [formGroup]="form" (ngSubmit)="handleConfirmEdit()">
    <mat-dialog-content>
      <!-- Top-level properties -->
      <div formGroupName="properties">
        <div *ngFor="let item of properties.controls | keyvalue">
          <mat-form-field appearance="outline">
            <mat-label>{{ item.key }}</mat-label>
            <input matInput formControlName="{{ item.key }}">
          </mat-form-field>
        </div>
      </div>
      <!-- Stops and their properties -->
      <div formArrayName="stops">
        <mat-card mat-elevation-z1 *ngFor="let stop of stops.controls; index as i">
          <div [formGroupName]="i">
            <!-- The stop title is not actually exposed as a form element, but used as content -->
            <mat-card-header>
              <mat-card-subtitle>{{ stop.value.title }}</mat-card-subtitle>
            </mat-card-header>
            <div formGroupName="properties">
              <div *ngFor="let item of stop.get('properties').controls | keyvalue">
                <mat-form-field appearance="outline">
                  <mat-label>{{ item.key }}</mat-label>
                  <input matInput formControlName="{{ item.key }}">
                </mat-form-field>
              </div>
            </div>
          </div>
        </mat-card>
      </div>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
      <button mat-icon-button aria-label="Confirm updating record"
        [disabled]="(form.valid === null) ? false : !form.valid" type="submit">
        <mat-icon>check</mat-icon>
      </button>
    </mat-dialog-actions>
  </form>
</app-projection-dialog>
<!-- END edit record modal -->